<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
<body>
	<ui:composition>

<h:form id="archivoPruebaListForm">
   			<h:panelGroup id="searchForm">
            	<p:panelGrid columns="2" columnClasses="column" styleClass="panelGridCenter">
            		
                    <p:outputLabel for="searchDate" value="#{msg.fecExamen}:" />
					<p:calendar id="searchDate" value="#{respuestaExamenController.searchDate}" pattern="MM/dd/yyyy" effect="fold"/>
            		
                	<p:outputLabel value="#{msg.user}:"  />
                    <h:panelGrid columns="2" style="width:100%" border="0">
                    
	                   <p:inputText id="txtInputSearch" value="#{respuestaExamenController.userNameSearch}" 
	                   			onblur="inputTextBlur( this, '#{respuestaExamenController.userNameSearch}' );" 
	                   			onfocus="inputTextFocus( this, '#{respuestaExamenController.userNameSearch}' );" />
	                   <p:commandLink id="cmdLink" actionListener="#{respuestaExamenController.advancedSearch}"  
	                   		oncomplete="PF('advanceSearchViewDialog').show()" update="archivoPruebaListForm:advanceSearchViewDlg">
	                       <span><h:graphicImage url="../resources/images/magnifier_16.png" width="17" height="17" /></span>
	                   </p:commandLink>
		            
			            <p:dialog id="advanceSearchViewDlg" widgetVar="advanceSearchViewDialog" modal="true" resizable="false" appendTo="@(body)" closeOnEscape="true">
				                <p:dataScroller id="dataScroller" value="#{respuestaExamenController.searchResultItems}" var="result" chunkSize="5" >
							        <f:facet name="loader">
							            <p:commandButton type="button" value="#{msg.more}" icon="ui-icon-circle-triangle-s" rendered="#{respuestaExamenController.showSearchData}"/>
							        	<h:outputText value="#{msg.emptySearch}" rendered="#{!respuestaExamenController.showSearchData}" style="font-weight: bold"/>
							        </f:facet>
							        <h:panelGrid columns="2" style="width:100%">
							            <p:outputPanel>
							                <h:panelGrid columns="3">
							                	<f:ajax execute="@form" render=":archivoPruebaListForm" onevent="PF('advanceSearchViewDialog').hide()">
								                    <h:outputText value="#{result.completeName}" style="font-weight: bold"/>
								                    <h:commandLink id="result-#{result.userId}" action="#{respuestaExamenController.selectResult(result)}">
								                        <span><h:graphicImage url="../resources/images/accept_16.png" width="12" height="12" /></span>
								                    </h:commandLink>
							                    </f:ajax>
							                </h:panelGrid>
							            </p:outputPanel>
							        </h:panelGrid>
							    </p:dataScroller>
				        </p:dialog>
                    </h:panelGrid>
            		
            		
          			<p:commandButton id="searchButton" icon="ui-icon-search" value="#{msg.search}" 
          				actionListener="#{respuestaExamenController.retrieveEntriesByUser}" update=":archivoPruebaListForm" />
       			</p:panelGrid>
           	</h:panelGroup>
              
        <p:panel header="#{msg.archivoPrueba}">
            <p:dataTable id="datalist"
                         value="#{respuestaExamenController.lazyModel}"
                         var="item"
                         rowKey="#{item.respuestaExamenId}"
                         paginator="true"
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                         rows="10"
                         rowsPerPageTemplate="10,20,30,40,50"
                         selectionMode="single"
                         selection="#{respuestaExamenController.selected}"
                         lazy="true">

                <p:ajax event="rowSelect"   />

                <p:column width="20px;">
                    <f:facet name="header">
                        <h:outputText value="#{msg.id}"/>
                    </f:facet>
                    <h:outputText value="#{item.respuestaExamenId}"/>
                </p:column>

                <p:column width="150px;" sortBy="#{item.userId.idNumber}" filterBy="#{item.userId.idNumber}">
                    <f:facet name="header">
                        <h:outputText value="#{msg.idNumber}"/>
                    </f:facet>
                    <h:outputText value="#{item.userId.idNumber}"/>
                </p:column>
                
                <p:column width="150px;" sortBy="#{item.userId.completeName}" filterBy="#{item.userId.completeName}">
                    <f:facet name="header">
                        <h:outputText value="#{msg.name}"/>
                    </f:facet>
                    <h:outputText value="#{item.userId.completeName}"/>
                </p:column>

                <p:column sortBy="#{item.archivoPruebaProcesadoId.nombreArchivo}" filterBy="#{item.archivoPruebaProcesadoId.nombreArchivo}">
                    <f:facet name="header">
                        <h:outputText value="#{msg.fileName}"/>
                    </f:facet>
                    <h:outputText value="#{item.archivoPruebaProcesadoId.nombreArchivo}"/>
                </p:column>
                
                <p:column width="150px;" sortBy="#{item.archivoPruebaProcesadoId.fecCre}" filterBy="#{item.archivoPruebaProcesadoId.fecCre}">
                    <f:facet name="header">
                        <h:outputText value="#{msg.date}"/>
                    </f:facet>
                    <h:outputText value="#{item.archivoPruebaProcesadoId.fecCre}"/>
                </p:column>

                <p:column>
                    <f:facet name="header">
                        <h:outputText value="#{msg.resultado}"/>
                    </f:facet>
                    <p:commandLink id="viewResultadoLink" value="#{msg.resultado}" update=":resultadoExamenViewForm, :resultadoExamenViewDlg" 
                    		oncomplete="PF('resultadoExamenViewDialog').show()" actionListener="#{respuestaExamenController.getByRespuestaExamenResultado(item)}"/>
                </p:column>

            </p:dataTable>

			<p:commandButton id="testExcel" icon="ui-icon-plus"   value="excel" actionListener="#{archivoPruebaController.procesarArchivoExcel}" />
            
        </p:panel>
        <ui:include src="/WEB-INF/templates/confirmation.xhtml"/>
    </h:form>
	</ui:composition>
</body>
</html>